# [IFKAKAO22] Sentry를 이용한 에러 추적기, React의 선언적 에러 처리

이슈 해결에서 이슈 파악에 많은 리소스가 요구된다 &rarr; 에러 추적 개선이 개발 리소스 관리에 중요한 역할을 한다

<br>

## 프론트엔드 발생 에러 종류 크게 4 가지

**_프론트 개발자 역량_**

- 데이터영역
- 화면영역

**_특이한 요인_**

- 외부 요인에 의한 에러
- 런타임 에러

**_런타임 에러는 예측이 불가하다_**

<br>

## 추적 개선법

여러가지 툴이 있지만, 카카오 페이에선 센트리를 사용한다

1. 에러 데이터 쌓기
2. 스코프 단위로 추적

   ```
   configureScope = global scope (공통 데이터에 활용)

   withScope = local scope
   ```

3. `setTag`태그를 통해 이슈 검색 및 트래킹

   > 인덱싱이 되는 요소 &rarr; 신속하게 대응 가능

4. 레벨 설정하여 중요도 식별

5. 핑거프린트를 통해 하나의 이슈로 그룹핑

<br>

**_severity 기준_**

> when, if, then

<br>

## 에러데이터 분석

**_약속된 에러에 대한 무분별한 수집은 오히려 방해됨_**<br>

chunk load와 네트워크는 환경마다 다르기 때문에 수집 제외 (단, 지표개선을 위해 타임아웃 에러는 수집)

<br>

## 센트리 에러 로깅을 통해 얻은점

- 브라우저 버전 문제나 빌드 설정 문제를 추적하여 사용자 경험 개선

- 장애 탐지 시간이 줄어듬

&rarr; 개발자 경험이 좋아짐

<br>

## 개선기

기존: `Axios interceptor`를 활용한 전역 처리 통해 활용

<br>

불편한점

1. 에러 화면을 보여주려면 라우트 이동으로 처리해야 함
2. 부분 에러를 처리하기 힘듬

<br>

개선 방향

- 에러바운더리 사용
  > 선언적 에러 처리

<br>

명령형 vs 선언형

```
명령형
어떻게?. 과정에 집중

선언형
무엇을?. 결과에 집중
```

<br>

**_리액트의 에러 바운더리는 이벤트 헨들러의 에러를 포착하지 않음_**

> React Query의 useErrorBoundary로 캐치 가능

<br>

따라서 액시오스 인터셉터 로직을 줄이고, 각각 도메인의 에러 바운더리로 위임
<br>
이후 에러바운더리의 관심사를 분리 (API, FE...)
<br>
루트에서 처리가 필요한건 상위 레벨 에러 바운더리로 전파

> 액시오스의 네트워크 에러는 에러바운더리에서 캐치하면 안 됨 (지연을 통해 처리)
